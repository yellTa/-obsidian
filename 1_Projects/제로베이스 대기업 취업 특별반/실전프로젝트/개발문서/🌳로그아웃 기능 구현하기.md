---
created: 2024-10-07 23:31
updated: 2024-10-08T01:49
tags:
  - develop
deadline: 
Progress:
  - ongoing
---
# 누구를 위한 기능?
제로 스페이스에 카카오 로그인을 통해  로그인이 된 사용자
# OBJECT/SUBJECT:
## branch = feat/login

# ANALYSIS:
## 기능 명세 파악하기
로그아웃 기능만들기
## Brain storming or 원인 파악하기
![[Pasted image 20241008003921.png | 700]]


## 문제 해결 방안 선택
위 이미지의 방법을 사용하기로 하자!
그리고 저 방법 밖에 생각이 안남 ㅠ
### 설계
![[Pasted image 20241008012431.png]]
## 고려해야할 사항
1. 카카오 로그아웃이 실패했을시 에러 메세질를 던져주어야한다. 

---
## 수행준비하기

### 설계하기
![[Pasted image 20241008013305.png| 700]]

### 수행할 작업 단위
한 사이클에 모두 담기로 한다. 
브레인 스토밍으로 작성한 사안과 똑같이 진행할 에정이다. 


# 수행하기
``` java 
@Controller  
@RequiredArgsConstructor  
public class LoginController {  
    private final OAuth2AuthorizedClientService authorizedClientService;  
  
    private final JWTTokenService jwtTokenService;  
  
    @GetMapping("/logout")  
    public ResponseEntity<String> logout(HttpSession session, OAuth2AuthenticationToken authentication, HttpServletResponse response) {  
        OAuth2AuthorizedClient authorizedClient = authorizedClientService.loadAuthorizedClient(  
                authentication.getAuthorizedClientRegistrationId(),  
                authentication.getName()  
        );  
  
        if (authentication != null) {  
            String kakaoToken = authorizedClient.getAccessToken().getTokenValue();  
            try {  
                HttpHeaders headers = new HttpHeaders();  
                headers.set("Authorization", "Bearer " + kakaoToken);  
  
                HttpEntity<Void> request = new HttpEntity<>(headers);  
                RestTemplate restTemplate = new RestTemplate();  
                String kakaoLogoutUrl = "https://kapi.kakao.com/v1/user/logout";  
  
                ResponseEntity<String> responseEntity = restTemplate.postForEntity(kakaoLogoutUrl, request, String.class);  
  
                if (!responseEntity.getStatusCode().is2xxSuccessful()) {  
                    return responseEntity;  
                }  
  
            } catch (HttpClientErrorException e) {  
                e.printStackTrace();  
            }  
        }  
        session.invalidate();  
        SecurityContextHolder.clearContext();  
        ResponseCookie refreshTokenCookie = ResponseCookie.from("refreshToken")  
                .path("/")  
                .sameSite("None")  
                .httpOnly(true)  
                .secure(true)  
                .maxAge(0) // 즉시 만료  
                .build();  
        response.addHeader("Set-Cookie", refreshTokenCookie.toString());  
        response.setHeader("Authorization", "");  
        return ResponseEntity.status(HttpStatus.FOUND)  
                .header("Location", "http://localhost:8080/")  
                .build();  
    }  
  
}
```

그냥 Controller에 모든 기능을 넣었다.
굳이 Service로 분리할 필요도 없고 JWT토큰 삭제 기능이 바뀔 것 같지도 않아서 설계 부분에서는 따로 제거 로직을 만들었었는데 그럴 필요가 없는 것 같다.

---
# 결론:
## 수행 작업:

## 결과 :


## 카카오 인증을 지우는 방법


>[!important]

# REVIEW:

---
# References

# 연결문서