---
created: 2024-09-19 19:14
updated: 2024-09-19T21:48
tags:
  - transaction
  - lock
  - database
출처: 
---
# 계좌이체 예시를 통해서 Lock을 알아보자
Transaction이 시작되면 사용자는 데이터에 쓰기, 읽기를 수행할 수 없다.
락이 걸려있기 때문에

## 계좌이체를 수행한다고 가정하자
1. data1사용자는 계좌이체를 위해서 Lock을 획득한다. 즉 데이터를 사용하고 있다는 뜻이다.  data1사용자는 돈을 인출할 예정이다. - data1이 lock을 가짐
2. data2사용자는 data1사용자에게 어플을 통해 계좌 이체를 수행하려고 한다. 하지만 data1이 사용중이기 때문에 대기한다.(Lock획득 대기)
3. data1사용자가 정상적으로 돈을 인출했다.(Lock반환)
4. data2사용자는 Lock을 얻고 data1에게 돈을 보낸다.

만약에 2번의 상황에서 Lock없다면?
그리고 2번의 상황에서 에러가 발생해 rollback을 수행했다면??

data1사용자는 계좌는 2000원을 인출하려고 한 상태이다. 근데 그 과정에서 에러가 발생했다.
data2 사용자는 에러가 발생하기 직전에 data1에게 계좌이체를 수행했다. 그때 계좌는 2000원이 빠진 8000원이었다. 거기에 10000원의 돈을 송금했다. (data1: 18000원, data2: 10000->0원)
하지만 data1의 사용자는 에러가 발생한 상태로 db를 원래 금액인 10000원으로 되돌렸다. 
최종 결과는 data1 : 10000원 data2:0원
즉 돈을 순식간에 잃어버렸다.

대충 lock이 뭔지 알게되었으니 h2 DB로 함께 확인해보자!








# 결론

# REVIEW


---
# 참고

# 연결문서