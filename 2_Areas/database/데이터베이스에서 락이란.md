---
created: 2024-10-06 18:45
updated: 2024-10-06T19:32
tags:
  - 면접
  - database
출처: 
---
# 락이란?
## 락
트랜잭션이 처리되는 순서를 보장해 무결성을 유지한다.
락을 이용할 때 트랜잭션이 교착상태에 빠질 수 있다.

## 락의 종류
### 공유락
데이터를 읽는 락으로 읽기락이라고도 한다. 데이터를 읽는 연산이므로 데이터의 일관성에 영향을 주지 않아 데이터에 여러 공유 락이 동시에 접근할 수 있다.

### 베타 락
데이터를 수정하는 락으로 쓰기 락이라고도 한다. 데이터의 일관성을 유지하기 위해 데이터에 하나의 베타 락이 접근 중일 때 다른 베타 락이 접근할 수 없다.

# 교착상태
한 트랜잭션이 자리이 처리중인 데이터에 대해 락을 가진 상태에서 다른 트랜잭션이 처리중인 데이터에 대해 락을 요청해 무한 대기상태에 빠진 상태이다.

## DB 교착상태 발생 조건
### 상호 배체
자원(테이블 ,행 등)한 번에 하나의 트랜잭션만 사용할 수 있다.
### 점유 대기
한 트랜잭션이 자신이 점유한 자원을 유지한 채로 추가적인 자원을 요청하며 대기한다. 

### 비선점:
트랜잰션이 자원을 강제로 빼앗길 수 없다. 트랜잭션이 끝나기 전 점유한 자원을 스스로 해제해야 다른 트랜잭션이 사용 가능하다.

### 순환 대기
자원 대기가 순환적으로 발생해야 한다. 
A는 자원 X를 점유하고 자원 Y를 기다리고 B는 자원 Y를 점유하고 자원 X를 기다릴때 두 트랜잭션이 대기하는 교착상태에 빠진다. 


## 교착상태 예시
- 트랜잭션 A는 table1의 업데이트를 위해 베타 락을 건다. 
- 트랜잭션 B는 table2에 업데이트를 위해 베타락을 건다.
- 트랜잭션 A는 tables2의 다른 행을 업데이트 하기 위해 자원을 요청하지만 이미 B에 의해 잠겨있다.
- 트랜잭션 B는 table1의 다른 행을 업데이트하기 위해 자원을 요청하지만 A에 의해 잠겨있다.

서로 점유한 자원을 기다리면서 무한 대기 상태에 빠지게 된다.
## 트랜잭션을 해결하기 위한 방법
### 1. 예방기법
트랜잭션 처리가 시작되기 전에 필요한 데이터에 대해 미리 락을 얻는 형식
자원을 모두 한 번에 할당하거나, 트랜잭션이 자원을 요청할 때 대기하지 않도록 설계
자원을 점유하지 않은 상태에서만 자원을 요청할 수 있도록 한다. 
### 2. 회피 기법
트랜잭션이 들어온 순서에 따라 교착상태를 회피하는 방식


---
# 질문이 들어온다면 어떻게 답해야할까?
## 락이 뭐죠?
트랜잭션의 처리순서를 보장하고 데이터의 무결성을 위해 사용합니다. 그중 공유 락은 데이터를 읽는 락으로 데이터의 일관성에 영향을 주지 않아 여러 공유 락이 동시에 접근할 수 있습니다. 베타 락은 데이터를 수정하는 락으로 데이터의 일관성을 유지하기 위해 하나의  하나의 트랜잭션을 수행 중일때 다른 베타 락, 공유 락이 접근할 수 없습니다.


## 교착상태가 뭐죠?
두 개의 트랜잭션이 서로 처리 중인 데이터에 대한 락을 요청하면서 무한히 대기하는 현상입니다. 만약 A트랜잭션이 자원 X를 점유하고 Y를 기다리는 상황에서 B 트랜잭션이 자원 Y를 점유하고 X를 기다리게 되면 서로 락을 요청하게 되면서 무한 대기 상태에 빠집니다. 이를 해결하기 위해서 예방 기법과 회피 기법이 있습니다. 
예방기법은 자원을 점유하지 않은 상태에서만 자원을 요청할 수 있도록 설정합니다. 회피기법은 트랜잭션이 들어온 순서에 따라서 락을 획득하거나 트랜잭션을 종료하는 방법입니다.



# REVIEW
실제 코드로 수행해보지 않았지만 이론을 공부해보았다.


---
# 참고
기술면접대비 CS전공 핵심 요약집(책)
# 연결문서